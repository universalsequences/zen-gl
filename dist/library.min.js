!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.gl=t():e.gl=t()}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{DrawType:()=>Ue,GLType:()=>n,abs:()=>ne,add:()=>y,and:()=>v,argument:()=>f,atan:()=>V,attribute:()=>a,black:()=>Le,blue:()=>Fe,breakIf:()=>c,call:()=>l,ceil:()=>M,cos:()=>O,cosh:()=>w,cross:()=>ee,defun:()=>o,div:()=>$,dot:()=>ie,emitAccumulators:()=>p,emitArguments:()=>s,emitAttributes:()=>i,emitFunctions:()=>u,eq:()=>U,exp:()=>Z,exp2:()=>te,float:()=>Xe,floor:()=>C,fract:()=>ae,func:()=>h,green:()=>ye,gt:()=>I,gte:()=>B,length:()=>re,log:()=>q,loopAccumulator:()=>d,lt:()=>S,lte:()=>N,mat2:()=>we,mat3:()=>De,mat4:()=>Ce,max:()=>k,min:()=>H,mix:()=>Y,mod:()=>W,mount:()=>Ie,mult:()=>L,normalize:()=>J,nuv:()=>Te,or:()=>_,perspectiveMatrix:()=>Me,pow:()=>P,red:()=>_e,resolution:()=>Ee,sign:()=>Q,sin:()=>G,sinh:()=>D,smoothstep:()=>j,sqrt:()=>K,step:()=>z,sub:()=>F,sumLoop:()=>m,tan:()=>X,texture2D:()=>oe,uniform:()=>Oe,unpack:()=>de,uv:()=>be,varying:()=>le,vec:()=>ge,vec2:()=>Ae,vec3:()=>xe,vec4:()=>Re,vector:()=>pe,viewMatrix:()=>Ge,white:()=>$e,x:()=>he,y:()=>ve,zen:()=>Se,zswitch:()=>ue});const r=e=>{let t,r;return n=>{if(void 0!==t){if(r===n)return n.isVariableEmitted(t.variable)?Object.assign(Object.assign({},t),{code:t.variable}):t;{if(n.isVariableEmitted(t.variable))return Object.assign(Object.assign({},t),{code:t.variable});let e=!1;if(t.variables)for(let r of t.variables)if(n.isVariableEmitted(r)){e=!0;break}if(!e){if(t.variables)for(let e of t.variables)n.emittedVariables[e]=!0;return n.emittedVariables[t.variable]=!0,t}}}return r=n,t=e(n),t}};var n;!function(e){e[e.Mat2=0]="Mat2",e[e.Mat3=1]="Mat3",e[e.Mat4=2]="Mat4",e[e.Bool=3]="Bool",e[e.Float=4]="Float",e[e.Vec2=5]="Vec2",e[e.Vec3=6]="Vec3",e[e.Vec4=7]="Vec4",e[e.Sampler2D=8]="Sampler2D",e[e.Function=9]="Function"}(n||(n={}));const a=(e,t,n=2,a=!1)=>{let i=[],o={name:"",type:e,data:t,size:n,isInstance:a},l=()=>{let t=r((t=>{if(!o.name){let[e]=t.useVariables("attribute");o.name=e}i.includes(t)||(i.push(t),t.attributes.push(l));let r=t.emit(e,"",o.name);return r.attributes||(r.attributes=[]),r.attributes.push(o),r}));return t.attribute=l,t};return l.set=e=>{o.data=e;for(let e of i)if(o.buffer){let t=e.webGLRenderingContext;t&&(t.bindBuffer(t.ARRAY_BUFFER,o.buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o.data),t.STATIC_DRAW))}},l.get=()=>o,l},i=(...e)=>{let t=new Set;for(let r of e)if(r.attributes)for(let e of r.attributes)t.add(e);return Array.from(t)},o=(e,t)=>{let r;return n=>{if(r)return r;let a=new T(n),i=a.gen(e),o="",l={};l=Object.assign({},e);let f=i.code;f.includes(";")||(f+=";"),o+=`\n${f}\n\nreturn ${i.variable};\n            `,r=Object.assign(Object.assign({},l),{type:i.type,variables:[],code:o,uniforms:i.uniforms,variable:t,functions:u(i),functionArguments:s(i)});for(let e of a.uniforms)n.uniforms.push(e);return r}},l=(e,...t)=>r((r=>{let n=t.map((e=>r.gen(e)));if("function"!=typeof e)return n[0];let a=e(r),i=a.variable,[o]=r.useVariables(`${i}Value`),l=`${r.printType(a.type)} ${o} = ${i}(${n.map((e=>e.variable)).join(",")}); \n`,u=r.emit(a.type,l,o,...n),s=void 0===u.functions?[]:u.functions;return u.functions=[...a.functions||[],...s,a],u.uniforms=[...u.uniforms||[],...a.uniforms||[]],u})),u=(...e)=>{let t=new Set;for(let r of e)if(r.functions)for(let e of r.functions)t.add(e);return Array.from(t)},s=(...e)=>{let t=new Set;for(let r of e)if(r.functionArguments)for(let e of r.functionArguments)t.add(e);return Array.from(t)},f=(e,t,n)=>r((r=>{let[a]=r.useVariables("funcArg");e+=a;let i=`${r.printType(n)} ${a} = ${e}; `,o=r.emit(n,i,a),l=[...o.functionArguments||[],{name:e,num:t,type:n,variable:a}];return l=Array.from(new Set(l)),o.functionArguments=l,o})),m=(e,t)=>r((r=>{let a=new T(r),i=a.gen(e),o=a.gen(0);r.idx=a.idx+100;let l=r.gen(t),f=p(i);console.log("function argums for loop=",f);let[m]=r.useVariables("loop_val");f[0]&&(m=f[0].name,o=f[0].initial,console.log("choosing loopVar=",m));let c=x([i,o]),d=r.printType(c),b=`\n${o.type===n.Float?"":o.code}\n${d} ${m} = ${o.variable};\nfor (float i=0.0; i < ${l.variable}; i++) {\n${i.code.split("\n").map((e=>"    "+e)).join("\n")}\n${m} += ${i.variable};\n}\n`;return console.log("code=",b),Object.assign(Object.assign({},i),{type:i.type,variables:[],code:b,uniforms:i.uniforms,variable:m,functions:u(i),functionArguments:s(i)})})),c=(e,t)=>r((r=>{let n=r.gen(e),a=r.gen(t),i=`\nif (${n.variable}) break;\n`;return r.emit(a.type,i,a.variable,n,a)})),d=(e,t)=>r((r=>{let n=r.gen(t),[a]=r.useVariables("accum");e+=a;let i=`${r.printType(n.type)} ${a} = ${e}; `,o=r.emit(n.type,i,a,n),l=[...o.loopAccumulators||[],{name:e,initial:n,type:n.type,variable:a}];return l=Array.from(new Set(l)),o.loopAccumulators=l,o})),p=(...e)=>{let t=new Set;for(let r of e)if(r.loopAccumulators)for(let e of r.loopAccumulators)t.add(e);return Array.from(t)};class b{constructor(e){this.idx=0,this.siblingContext=e,this.emittedVariables={},this.attributes=[],this.uniforms=[],this.varyings=[],this.errors=[],this.textures=[],this.webGLRenderingContext=null,this.webGLProgram=null}isVariableEmitted(e){return!0===this.emittedVariables[e]}useVariables(...e){let t=this.idx++;return e.map((e=>`${e}${t}`))}gen(e){return void 0===e&&(e=0),"number"==typeof e?E(e)(this):e(this)}printType(e){return e===n.Float?"float":e===n.Bool?"bool":e===n.Vec2?"vec2":e===n.Vec3?"vec3":e===n.Vec4?"vec4":e===n.Mat2?"mat2":e===n.Mat3?"mat3":e===n.Mat4?"mat4":"sampler2D"}emitError(e){this.errors.push(e)}initializeTexture(e,t,r,n){let a=r.unit||0;e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));const i=e.RGBA,o=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,0,i,r.width,r.height,0,i,o,r.initialData)}initializeTextures(e,t){let r=null,n=0;for(let a=0;a<this.textures.length;a++){let i=this.textures[a];if(e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),i.feedback){let a=[],o=[],l=[];i.width=t.width,i.height=t.height,i.initialData=null;for(let t=0;t<2;t++){const r=e.createTexture(),u=e.createFramebuffer();if(!u||!r)return null;let s=n;l[t]=s,n++,this.initializeTexture(e,r,i,!1),e.bindFramebuffer(e.FRAMEBUFFER,u),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),o[t]=u,a[t]=r,e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}i.frameBuffers=o,i.textures=a,i.units=l,i.currentFrameBuffer=0,r=i}else{const t=e.createTexture();if(!t)continue;i.unit=n,n++,i.texture=t,this.initializeTexture(e,t,i,!1)}const o=e.RGBA,l=e.UNSIGNED_BYTE;i.format=o,i.type=l,i.initialized=!0,i.parameters={[e.TEXTURE_WRAP_S]:e.CLAMP_TO_EDGE,[e.TEXTURE_WRAP_T]:e.CLAMP_TO_EDGE,[e.TEXTURE_MIN_FILTER]:e.LINEAR,[e.TEXTURE_MAG_FILTER]:e.LINEAR}}return r}initializeUniforms(){for(let e of this.uniforms)e.set()}emit(e,t,r,...n){let a=new Set([r]);for(let{variables:e}of n)e&&e.forEach((e=>a.add(e)));let o=new Set([]);for(let{uniforms:e}of n)void 0!==e&&e.forEach((e=>o.add(e)));return{code:g(this,t,r,...n),uniforms:Array.from(o),variable:r,type:e,variables:Array.from(a),functions:u(...n),functionArguments:s(...n),loopAccumulators:p(...n),attributes:i(...n)}}}class T extends b{constructor(e){super(),this.parentContext=e}}const E=e=>{let t=e.toString();return e-Math.floor(e)==0&&(t+=".0"),()=>({code:t,variable:t,variables:[],type:n.Float})},g=(e,t,r,...n)=>{let a="";e.emittedVariables[r]=!0;for(let t of n)A(t)&&(a+=t.code,e.emittedVariables[t.variable]=!0);return a+"\n"+t},A=e=>e.code!==e.variable,x=e=>{let t=e.map((e=>e.type));return Math.max(...t)},R=(e,t,n)=>(...a)=>r((r=>{let i=a.map((e=>r.gen(e))),[o]=r.useVariables(t+"Val"),l=void 0===n?x(i):n,u=`${r.printType(l)} ${o} = ${i.map((e=>e.variable)).join(e)};`;return r.emit(l,u,o,...i)})),h=(e,t=e,n,a)=>(...i)=>r((r=>{let o=i.map((e=>r.gen(e))),[l]=r.useVariables(`${t}Val`),u=void 0===a?x(o):a,s=r.printType(u),f=i.length>0&&n&&i.every((e=>"number"==typeof e))?`${s} ${l} = ${n(...i)};`:`${s} ${l} = ${e}(${o.map((e=>e.variable)).join(",")});`;return r.emit(u,f,l,...o)})),v=R("&&","and",n.Bool),_=R("||","or",n.Bool),y=R("+","add"),F=R("-","sub"),L=R("*","mult"),$=R("/","div"),S=R("<","lt",n.Bool),I=R(">","gt",n.Bool),B=R(">=","gte",n.Bool),N=R("<=","lte",n.Bool),U=R("==","eq",n.Bool),P=h("pow","pow",Math.pow),V=h("atan","atan",Math.atan2),w=h("cosh","cosh",Math.cosh),D=h("sinh","sinh",Math.sinh),C=h("floor","floor",Math.floor),M=h("ceil","ceil",Math.ceil),G=h("sin","sin",Math.sin),O=h("cos","cos",Math.cos),X=h("tan","tan",Math.tan),j=h("smoothstep"),z=h("step"),Y=h("mix"),H=h("min"),k=h("max"),W=h("mod"),q=h("log"),K=h("sqrt"),Q=h("sign"),J=h("normalize"),Z=h("exp"),ee=h("cross"),te=h("exp2"),re=h("length","length",void 0,n.Float),ne=h("abs","abs"),ae=h("fract","fract"),ie=h("dot","dot",void 0,n.Float),oe=(e,t)=>r((r=>{let a=r.gen(e),i=r.gen(t),[o]=r.useVariables("texSample"),l=`\nvec4 ${o} = texture2D(${a.variable}, ${i.variable});\n`;return r.emit(n.Vec4,l,o,a,i)})),le=e=>r((t=>{let r=t.siblingContext?t.siblingContext.gen(e):t.gen(e),n=r.variable,a=r.type;if(!n){let e=r.attribute;if(e){let t=e.get();n=t.name,a=t.type}}let[i]=t.useVariables("v_varying_"),o=r.code===n?"":r.code;return t.varyings.push({name:i,type:a,attributeName:n,code:o}),t.emit(r.type,"",i)})),ue=(e,t,n)=>r((r=>{let a=r.gen(e),i=r.gen(t),o=r.gen(n),[l]=r.useVariables("switch_val"),u=x([i,o]),s=`\n${r.printType(u)} ${l} = ${a.variable} ? ${i.variable} : ${o.variable};\n`;return r.emit(u,s,l,a,i,o)}));function se(e,t,r){const n=e.createShader(t);return n?(e.shaderSource(n,r),e.compileShader(n),n):null}const fe=(e,t,r,n=[])=>{let a=e.code;a+=`\n${r} = ${e.variable}; `;let i="",o=new Set;if(e.uniforms)for(let r of e.uniforms)o.has(r.name)||(i+=`\nuniform ${t.printType(r.type)} ${r.name};\n`,o.add(r.name));let l="";if(e.functions)for(let r of e.functions)l+=me(t,r);let u="";for(let e of[...t.varyings,...n])u+=`varying ${t.printType(e.type)} ${e.name};\n`;let s="";if(t.attributes)for(let e of t.attributes)s+=`attribute ${t.printType(e.get().type)} ${e.get().name};\n`;let f="";for(let e of n)f+=`\n    ${e.code}\n    ${e.name} = ${e.attributeName};\n`;let m=`\nprecision mediump float;\nuniform vec2 resolution;\n${i}\n${s}\n${u}\n\n${l}\n\nvoid main() {\n${a.split("\n").map((e=>"    "+e)).join("\n")}\n${f}\n}\n`;return m},me=(e,t)=>{let r=`${e.printType(t.type)} ${t.variable}(`;return t.functionArguments&&(r+=t.functionArguments.sort(((e,t)=>e.num-t.num)).map((t=>`${e.printType(t.type)} ${t.name}`)).join(",")),r+=`) {\n${t.code}\n}\n`,r},ce=e=>()=>r((t=>{let[r]=t.useVariables(e+"Val"),a=n.Float,i=`${t.printType(n.Float)} ${r} = gl_FragCoord.${e};`;return t.emit(a,i,r)})),de=e=>t=>r((r=>{let a=r.gen(t),[i]=r.useVariables(e+"Val"),o=1===e.length?n.Float:2===e.length?n.Vec2:n.Vec3,l=`${r.printType(o)} ${i} = ${a.variable}.${e};`;return r.emit(o,l,i,a)})),pe=e=>{let t=e;return t.x=de("x")(t),t.y=de("y")(t),t.z=de("z")(t),t.w=de("w")(t),t},be=()=>pe(r((e=>{let[t]=e.useVariables("uv"),r=`${e.printType(n.Vec2)} ${t} = ((gl_FragCoord.xy-resolution)/resolution.y) ;\n        `;return e.emit(n.Vec2,r,t)}))),Te=()=>pe(r((e=>{let[t]=e.useVariables("nuv"),r=`${e.printType(n.Vec2)} ${t} = ((gl_FragCoord.xy)/resolution.xy)/2.0 ;\n        `;return e.emit(n.Vec2,r,t)}))),Ee=()=>pe(r((e=>{let[t]=e.useVariables("res"),r=`${e.printType(n.Vec2)} ${t} = resolution.xy/2.0 ;\n        `;return e.emit(n.Vec2,r,t)}))),ge=e=>(...t)=>pe(r((r=>{let n=t.map((e=>r.gen(e))),[a]=r.useVariables("vectorVal"),i=r.printType(e),o=`${i} ${a} = ${i} (${n.map((e=>e.variable)).join(",")}); `;return r.emit(e,o,a,...n)}))),Ae=ge(n.Vec2),xe=ge(n.Vec3),Re=ge(n.Vec4),he=ce("x"),ve=ce("y"),_e=()=>Re(1,0,0,1),ye=()=>Re(0,1,0,1),Fe=()=>Re(0,0,1,1),Le=()=>Re(0,0,0,1),$e=()=>Re(1,1,1,1),Se=(e,t,r=Ue.TRIANGLE_STRIP)=>{if(!t){const e=a(n.Vec3,[1,1,-1,1,1,-1,-1,-1],2),r=pe(e());t=Re(r.x,r.y,r.z,1)}let i=new b,o=new b(i),l=i.gen(t),u=o.gen(e);return{drawType:r,fragment:fe(u,o,"gl_FragColor"),vertex:fe(l,i,"gl_Position",o.varyings),fragmentContext:o,vertexContext:i}},Ie=(e,t)=>{console.log("mounting =",e);const r=t.getContext("webgl",{preserveDrawingBuffer:!0});if(!r)return console.error("Unable to initialize WebGL. Your browser may not support it."),null;const n=r.getExtension("ANGLE_instanced_arrays");if(!n)return console.error("Your browser does not support ANGLE_instanced_arrays"),null;let a=0,i=0,o=[],l=null;for(let a of e){const e=Be(r,a.vertex,a.fragment);if(!e)return null;let i=e.program;o.push(e),a.fragmentContext.webGLProgram=i,a.fragmentContext.webGLRenderingContext=r,a.vertexContext.webGLProgram=i,a.vertexContext.webGLRenderingContext=r,r.useProgram(i),l=a.fragmentContext.initializeTextures(r,t),a.fragmentContext.initializeUniforms();let u=0,s=0;a.buffers=[],a.binds=[];for(let e of a.vertexContext.attributes){let t=r.createBuffer();if(t){a.buffers.push(t);let o=e.get();if(o.buffer=t,a.binds.push((()=>{let e=r.getAttribLocation(i,o.name);if(r.bindBuffer(r.ARRAY_BUFFER,t),r.vertexAttribPointer(e,o.size,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e),o.isInstance){let e=r.getAttribLocation(i,o.name);n.vertexAttribDivisorANGLE(e,1)}else{let e=r.getAttribLocation(i,o.name);n.vertexAttribDivisorANGLE(e,0)}})),o.isInstance){let e=o.data.length/o.size;s<e&&(s=e)}else{let e=o.data.length/o.size;u<e&&(u=e)}e.set(o.data)}}if(a.indices){let e=r.createBuffer();if(null===e)return null;a.indexBuffer=e,r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),r.bufferData(r.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.indices),r.STATIC_DRAW)}a.instanceCount=s,a.vertexCount=u,a.program=i}r.enable(r.DEPTH_TEST),r.enable(r.BLEND),r.depthFunc(r.LEQUAL),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let u=l?function(e){const t=se(e,e.VERTEX_SHADER,"\n// Vertex shader for rendering a full-screen quad\nattribute vec2 aPosition;\nvarying vec2 vTexCoord;\n\nvoid main() {\n    vTexCoord = aPosition * 0.5 + 0.5; // Map from [-1, 1] to [0, 1]\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}\n"),r=se(e,e.FRAGMENT_SHADER,"\n// Fragment shader for sampling the texture\nprecision mediump float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vTexCoord);\n}\n");if(!t||!r)return null;const n=function(e,t,r){const n=e.createProgram();return n?(e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),n):null}(e,t,r);if(!n)return null;const a=e.getAttribLocation(n,"aPosition"),i=e.getUniformLocation(n,"uTexture"),o=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),{program:n,positionLocation:a,textureLocation:i,positionBuffer:o}}(r):null;return(s,f)=>{if("dispose"===s){for(let t of o)for(let n of e){n.program&&(r.detachShader(n.program,t.vertexShader),r.detachShader(n.program,t.fragmentShader),r.deleteProgram(n.program));for(let e of n.fragmentContext.textures)e.texture?r.deleteTexture(e.texture):e.textures&&e.textures.forEach((e=>r.deleteTexture(e))),e.frameBuffers&&e.frameBuffers.forEach((e=>r.deleteFramebuffer(e)))}return}r.clearColor(0,0,0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);let m=!1;s===a&&f===i||(m=!0);for(let o of e)if(o.program){if(r.useProgram(o.program),m){for(let t of e)if(t.program){let e=r.getUniformLocation(t.program,"resolution");r.uniform2f(e,s/2,f/2)}r.viewport(0,0,s,f),t.width=s,t.height=f,a=s,i=f,l&&l.textures&&l.textures.forEach((e=>{r.bindTexture(r.TEXTURE_2D,e),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,s,f,0,r.RGBA,r.UNSIGNED_BYTE,null)}))}if(l&&l.frameBuffers&&l.textures&&void 0!==l.currentFrameBuffer&&l.units&&l.uniformName){let e=l.currentFrameBuffer,t=l.frameBuffers[e];r.bindFramebuffer(r.FRAMEBUFFER,t);let n=l.units[1-e];r.activeTexture(r.TEXTURE0+n),r.bindTexture(r.TEXTURE_2D,l.textures[1-e]);let a=r.getUniformLocation(o.program,l.uniformName);r.uniform1i(a,n)}o.binds&&o.binds.forEach((e=>e()));const c=0;let d=Pe(r,o.drawType);if(o.instanceCount>0?n.drawArraysInstancedANGLE(d,0,o.vertexCount,o.instanceCount):o.indexBuffer&&o.indices?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o.indexBuffer),r.drawElements(d,o.indices.length,r.UNSIGNED_SHORT,0)):r.drawArrays(d,c,o.vertexCount),l&&l.frameBuffers&&l.textures&&void 0!==l.currentFrameBuffer&&l.units&&l.uniformName&&u){let e=u.program;r.bindFramebuffer(r.FRAMEBUFFER,null),r.useProgram(e),r.clearColor(0,0,0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);let t=l.currentFrameBuffer;r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.textures[t]);let n=u.textureLocation;r.uniform1i(n,0),r.bindBuffer(r.ARRAY_BUFFER,u.positionBuffer),r.vertexAttribPointer(u.positionLocation,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(u.positionLocation),r.drawArrays(r.TRIANGLE_STRIP,0,4),l.currentFrameBuffer=1-l.currentFrameBuffer}}}},Be=(e,t,r)=>{const n=Ne(e,e.VERTEX_SHADER,t),a=Ne(e,e.FRAGMENT_SHADER,r);if(!n||!a)return null;const i=e.createProgram();return i?(e.attachShader(i,n),e.attachShader(i,a),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?{program:i,vertexShader:n,fragmentShader:a}:null):null},Ne=(e,t,r)=>{const n=e.createShader(t);return n?(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n),null)):null};var Ue;!function(e){e[e.TRIANGLES=0]="TRIANGLES",e[e.TRIANGLE_STRIP=1]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=2]="TRIANGLE_FAN",e[e.LINE_LOOP=3]="LINE_LOOP",e[e.LINE_STRIP=4]="LINE_STRIP",e[e.LINES=5]="LINES"}(Ue||(Ue={}));const Pe=(e,t)=>{switch(t){case Ue.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;case Ue.TRIANGLE_FAN:return e.TRIANGLE_FAN;case Ue.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;case Ue.LINES:return e.LINES;case Ue.LINE_LOOP:return e.LINE_LOOP;case Ue.LINE_STRIP:return e.LINE_STRIP;default:return e.TRIANGLES}},Ve=e=>(...t)=>r((r=>{let n=t.map((e=>r.gen(e))),[a]=r.useVariables("matVal"),i=r.printType(e),o=`${i} ${a} = ${i} (${n.map((e=>e.variable)).join(",")}); `;return r.emit(e,o,a,...n)})),we=Ve(n.Mat2),De=Ve(n.Mat3),Ce=Ve(n.Mat4),Me=(e,t,r,n)=>{const a=$(1,X($(e,2)));return Ce($(a,t),0,0,0,0,a,0,0,0,0,$(y(n,r),F(r,n)),-1,0,0,$(L(2,L(n,r)),F(r,n)),0)},Ge=(e,t,r)=>{let n=pe(J(F(e,t))),a=pe(J(ee(r,n))),i=pe(ee(n,a));return Ce(a.x,i.x,n.x,0,a.y,i.y,n.y,0,a.z,i.z,n.z,0,L(-1,ie(a,e)),L(-1,ie(i,e)),L(-1,ie(n,e)),1)},Oe=(e,t,a,i,o)=>{let l,u,s=[],f=t,m="_"+Math.floor(1e5*Math.random()),c=()=>r((r=>{let f=r;for(;f.parentContext;)f=f.parentContext;let[d]=r.useVariables("uniform"+m);l&&(d=l.name),l={name:d,type:e},s.push(f);let p=r.emit(e,"",d);return p.uniforms||(p.uniforms=[]),p.uniforms.push(l),r.uniforms.push(c),e===n.Sampler2D&&(u={initialized:!1,width:a||1,height:i||1,initialData:Array.isArray(t)?new Uint8Array(t):null,feedback:o,uniformName:o?d:void 0},r.textures.push(u),r.parentContext&&r.parentContext.textures.push(u)),r.parentContext&&r.parentContext.uniforms.push(c),p}));return c.set=(e=f)=>{if(f=e,u&&l){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return;for(let t of s){let r=t.webGLRenderingContext,n=t.webGLProgram;if(r&&n&&void 0!==u.unit&&u.texture){let t=u.texture,a=u.format||r.RGBA,i=u.type||r.UNSIGNED_BYTE;r.useProgram(n),r.activeTexture(r.TEXTURE0+u.unit),r.bindTexture(r.TEXTURE_2D,t);let o=ArrayBuffer.isView(e)?e:new Uint8Array(e);r.texImage2D(r.TEXTURE_2D,0,a,u.width,u.height,0,a,i,o);let s=r.getUniformLocation(n,l.name);r.uniform1i(s,u.unit)}}}else if(l)for(let t of s){let r=t.webGLRenderingContext,n=t.webGLProgram;if(r&&n){let t=r.getUniformLocation(n,l.name);r.useProgram(n),r.uniform1f(t,e)}}},c.isTexture=()=>void 0!==u,c.getWidth=()=>a,c.getHeight=()=>i,c},Xe=E;return t})()));